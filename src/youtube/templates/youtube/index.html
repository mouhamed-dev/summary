{% load static %}
<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#163e5d',
                        secondary: '#6c757d',
                    },
                    fontFamily: {
                        sans: ['Inter', 'ui-sans-serif', 'system-ui']
                    }
                }
            }
        }
    </script>

    <!-- Open graph -->
    <meta property="og:title" content="G√©n√©rateur de QR Code" />
    <meta property="og:description" content="Cr√©ez des codes QR instantan√©ment et gratuitement sans limite." />
    <meta property="og:image" content="https://qrcode.mouhatech.com/static/Generator/images/qr_code.png" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://qrcode.mouhatech.com/" />
    <meta property="og:site_name" content="G√©n√©rateur de QR Code" />


    <!-- Select2 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-rc.0/css/select2.min.css" rel="stylesheet" />

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Select2 JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-rc.0/js/select2.min.js"></script>

    <link rel="icon" type="image/png" href="{% static 'youtube/images/summary.svg' %}">
    <link rel="stylesheet" href=" {% static 'youtube/css/style.css' %}">
    <link rel="stylesheet" href=" {% static 'youtube/css/select.css' %}">
    <title>R√©sum√© vid√©o YouTube</title>
</head>

<body class="flex items-center justify-center p-4">
    <div class="w-full max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-8 fade-in">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-2 drop-shadow-lg">R√©sum√© de vid√©os YouTube</h1>
            <p class="text-white/90 text-lg">R√©sumez automatiquement des vid√©os YouTube </p>
        </div>

        <!-- carte principale -->
        <div class="glass-effect rounded-2xl p-4 md:px-8 md:py-6 shadow-2xl fade-in">
            <form method="post" id="qrForm" enctype="multipart/form-data" class="space-y-6">
                {% csrf_token %}
                <!-- Input Section -->
                <div class="space-y-4">
                    <label for="url" class="block text-gray-700 font-semibold text-lg">Entrez le lien d'une vid√©o YouTube</label>
                    <div class="relative">
                        <input type="text" id="url" name="url" placeholder="Coller le lien youtube ici"
                            class="w-full px-4 py-3 pr-12 border-2 border-gray-300 rounded-xl input-focus transition-all duration-300 text-gray-700 placeholder-gray-400"
                            required>
                        <div onclick="pasteFromClipboard()" class="absolute bg-gray-300 px-2 py-1 rounded-xl right-3 top-1/2 -translate-y-1/2 cursor-pointer" title="Coller">
                            <i class="fa-solid fa-clipboard mr-2 text-primary cursor-pointer"></i>Coller
                        </div>
                    </div>

                    <script>
                        function isYoutube(url) {
                            return /(youtube\.com|youtu\.be)/.test(url);
                        }

                        async function pasteFromClipboard() {
                            try {
                                const text = await navigator.clipboard.readText();
                                if (!isYoutube(text)) {
                                    alert("{{salutation}}, seul les liens youtube sont accept√©s !");
                                    return;
                                }
                                lien = document.getElementById("url");
                                lien.value = text;
                                lien.focus();
                            } catch (e) {
                                alert("Erreur, permission refus√©e.");
                            }
                        }
                    </script>
                        

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="langue" class="block text-gray-700 font-semibold mb-2">Langue de sortie</label>
                            <select id="langue" name="langue" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl bg-white text-gray-700">
                                <option value="fr">Fran√ßais</option>
                                <option value="en">English</option>
                                <option value="ar">Arabe</option>
                                <option value="es">Espagnol</option>
                                <option value="de">Allemand</option>
                                <option value="it">Italien</option>
                                <option value="pt">Portugais</option>
                            </select>
                        </div>
                        <div>
                            <label for="taille" class="block text-gray-700 font-semibold mb-2">Taille du r√©sum√©</label>
                            <select id="taille" name="taille" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl bg-white text-gray-700">
                                <option value="short">Court</option>
                                <option selected value="medium">Moyen</option>
                                <option value="long">Long</option>
                            </select>
                        </div>
                    </div>

                </div>

                <!-- bouton generate -->
                <button type="submit" id="generateBtn"
                    class="w-full py-3 px-6 rounded-xl text-white font-semibold text-lg shadow-lg"
                    style="background: linear-gradient(135deg, #163e5d 0%, #163e5d 100%);">
                    <span class="flex items-center justify-center gap-2">
                        <i class="fa-solid fa-video text-white"></i>
                        R√©sumer la vid√©o
                    </span>
                </button>
            </form>

            <!-- Section resum√© -->
            <div id="resumeContainer" class="mt-8 qr-container" style="display: none;">
                <div class="bg-gray-50 rounded-xl p-6 border-2 border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4 text-center">R√©sum√© de la vid√©o</h2>
                    <div class="flex flex-col items-center space-y-4">
                        <p id="result" class="whitespace-pre-wrap text-gray-800"></p>
                        <button id="resetBtn" type="button" class="mt-4 px-4 py-2 rounded-lg text-white"
                            style="background: #6c757d; display: none;">
                            R√©initialiser
                        </button>
                    </div>
                </div>
            </div>

        </div>

        <!-- Footer -->
        <div class="text-center mt-20 text-white/80 text-sm">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <p>¬© 2025 R√©sum√© de vid√©o gratuit et sans limite</p>
                <p>Developp√© avec ü§ç par <a href="https://mouhatech.com" target="_blank"><span
                            class="text-white font-bold">MouhaTech</span></a></p>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const form = document.getElementById('qrForm');
                const btn = document.getElementById('generateBtn');
                const resumeContainer = document.getElementById('resumeContainer');
                const resultElem = document.getElementById('result');
                const resetBtn = document.getElementById('resetBtn');

                const reset = () => {
                    form.reset();
                    resultElem.textContent = '';
                    resumeContainer.style.display = 'none';
                    resetBtn.style.display = 'none';
                };

                resetBtn.addEventListener('click', reset);

                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    await summarize(btn, resumeContainer, resultElem, resetBtn, form);
                });
            });

            async function summarize(btn, resumeContainer, resultElem, resetBtn, form) {
                const originalText = btn.innerHTML;
                btn.disabled = true;
                btn.setAttribute('aria-busy', 'true');
                btn.innerHTML = '<span class="flex items-center justify-center gap-2"><i class="fa-solid fa-spinner animate-spin"></i> R√©sum√© en cours.. Patientez..</span>';

                resumeContainer.style.display = 'none';
                resultElem.textContent = '';

                // R√©cup√©rer tous les champs du formulaire
                const formData = new FormData(form);
                try {
                    const res = await fetch('/api/summarize/', {
                        method: 'POST',
                        body: formData
                    });
                    const data = await res.json();
                    resumeContainer.style.display = 'block';
                    if (data.summary_html) {
                        resultElem.innerHTML = data.summary_html;
                    } else if (data.summary) {
                        resultElem.textContent = data.summary;
                    } else if (data.error) {
                        resultElem.textContent = 'Erreur: ' + data.error;
                    } else {
                        resultElem.textContent = 'Erreur: R√©ponse invalide du serveur.';
                    }
                    resetBtn.style.display = 'inline-block';
                } catch (err) {
                    resumeContainer.style.display = 'block';
                    resultElem.textContent = 'Erreur du serveur: ' + err;
                    resetBtn.style.display = 'inline-block';
                } finally {
                    btn.disabled = false;
                    btn.removeAttribute('aria-busy');
                    btn.innerHTML = originalText;
                }
            }
        </script>

        <script src=" {% static 'youtube/js/script.js' %}"></script>

</body>
</html>